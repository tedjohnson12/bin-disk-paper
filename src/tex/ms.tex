% Define document class
\documentclass[twocolumn]{aastex631}
\usepackage{showyourwork}
\usepackage{amsmath}
\usepackage{bm}
\usepackage{natbib}

\newcommand\ghurl[0]{\url{https://github.com/tedjohnson12/bin-disk-paper}}
\newcommand\codeurl[0]{https://github.com/tedjohnson12/polar-disk-freq}
\newcommand\getref[0]{(\textcolor{red}{ref?})}
\newcommand\question[1]{[\textcolor{red}{#1}]}

\newcommand{\TJ}[1]{\textcolor{orange}{#1}}
\newcommand{\RGM}[1]{\textcolor{cyan}{#1}}

\DeclareMathOperator{\arctantwo}{arctan2}
\DeclareMathOperator{\arccsc}{arccsc}

% Begin!
\begin{document}

% Title
\title{The fraction of polar aligned circumbinary disks}

% Author list
\author[0000-0002-1570-2203]{Ted Johnson}
%\affiliation{Department of Physics and Astronomy, University of Nevada, Las Vegas, 4505 South Maryland Parkway, Las Vegas, NV 89154, USA}
\author[0000-0003-2401-7168]{Rebecca G. Martin}
%\affiliation{Department of Physics and Astronomy, University of Nevada, Las Vegas, 4505 South Maryland Parkway, Las Vegas, NV 89154, USA}
\author[0000-0003-2270-1310]{Stephen Lepp}
\affiliation{Nevada Center for Astrophysics, University of Nevada, Las Vegas, 4505 South Maryland Parkway, Las Vegas, NV 89154, USA}
\affiliation{Department of Physics and Astronomy, University of Nevada, Las Vegas, 4505 South Maryland Parkway, Las Vegas, NV 89154, USA}
\author[0000-0002-4636-7348]{Stephen H. Lubow}
\affiliation{Space Telescope Science Institute, 3700 San Martin Drive, Baltimore, MD 21218, USA}

% Abstract with filler text
\begin{abstract}

    Circumbinary gas disks that are misaligned to the binary orbital plane evolve toward either a coplanar or a polar-aligned configuration with respect to the binary host. The preferred alignment depends on the dynamics of the disk: whether it undergoes libration or circulating nodal precession, with librating disks evolving to polar inclinations and circulating disks evolving to coplanar.
    We quantify the fraction of binary star systems whose disks are expected to have polar orbits $f_\text{polar}$, extending previous work to include disks with non-zero mass.
    Our results suggest that, for low mass disks, the polar fraction is highly sensitive to the distribution of binary eccentricity with a higher fraction expected for higher binary eccentricities, $f_{\rm polar}\sim e_{\rm b}$. However, for massive discs, the fraction is independent of the binary eccentricity and $f_{\rm polar}\approx 0.37$. The value of $f_\text{polar}$ is always reduced in a population with a greater preference for low initial mutual inclination.
    We also explore the consequences of the finite lifetime and non-zero radial extent of a real disk, which are incomplete evolution and a limit on the relative angular momentum imposed by disk breaking and gravitational instability, respectively. Our findings can be used to make predictions given populations with well-understood distributions of binary eccentricity, initial mutual inclination, and disk angular momentum.
\end{abstract}

\section{Introduction}
\label{sec:intro}


Observed circumbinary planets -- those orbiting two stars -- have mostly been found to orbit in the same plane as their hosts \citep{doyle2011,orosz2012,welsh2012}. While this preference is the result of target selection effects (\citealt{martin2014}, see also \citealt{martin2015}, \citealt{martin2017a}), it is also representative of the fact that, for the disk progenitors of these planets \citep[from which the planets inherit orbital parameters, see][]{childs2021}, a coplanar alignment is one of two possible stable orientations \citep{bate2000,lubow2000}. The other configuration -- a polar disk -- is characterized by being inclined $90^\circ$ relative to the binary orbital plane \citep{aly2015,martin2017}. Evidence for one polar planet has been found via indirect means \citep[AC Her, ][]{hillen2015,anugu2023,martin2023}, and only a handful of confirmed polar disks have ever been discovered. These include a polar debris disk in the 99 Her system (\citealt{kennedy2012}, which likely evolved from a polar gas disk, see \citealt{smallwood2020}) and polar gas disks in the HD 98800 \citep{kennedy2019} and V773 Tau \citep{kenworthy2022} systems.

Through surveys of recent literature in circumbinary disk characterization \citep{czekala2019,zurlo2023}, \citet{ceppi2024} estimate that the fraction of circumbinary disks which are polar ($f_\text{polar}$) is $0.17 \pm 0.08$, though they acknowledge that the sample size is small ($\sim 15$ disks) and that the mutual inclination is hard to measure. They place this result in the context of a theoretical framework for a massless disk \citep{farago2010,lubow2018,zanazzi2018} to conclude that observations are not telling the whole story. In this work, we use the results of \citet{martin2019} to extend this theoretical framework to massive disks.

Given enough time, a gas disk that is misaligned from one of the two stationary inclinations moves to alignment through torques excited by warps that form as the disk undergoes differential precession \citep{bate2000,lubow2000}. Disks which are misaligned from coplanar only slightly (including the anti-aligned case where the mutual inclination $i\sim\pi$) undergo prograde or retrograde nodal precession \citep{papaloizou1995}. \citet{bate2000} and \citet{lubow2000} show that this kind of motion leads to coplanar alignment on a timescale that scales as $h^2/\alpha$, where $h$ and $\alpha$ are the disk aspect ratio and viscosity parameter, respectively.

When the mutual inclination is $\sim\pi/2$ (near polar), the disk can librate about the eccentricity vector of the binary \citep[e.g.,][]{verrier2009,farago2010,doolin2011}. In sufficiently massive disks, a third kind of motion arises at high inclinations. Prograde precession takes over from retrograde precession near the anti-aligned point, and {\it crescent} orbits take over at inclinations between libration and high-inclination precession (\citealt{chen2019}, see also \citealt{zanazzi2018}), named because of the shape they form on a phase diagram. \citet{abod2022} showed that both librating and crescent orbiting disks decay to the stationary polar inclination \citep[see][]{martin2019} on an evolutionary timescale similar to that of coplanar alignment.

Thus, when the disk lifetime is longer than the alignment timescale, it is appropriate to map the secular dynamics (which we call the dynamical state, e.g. nodal precession, libration or crescent orbits) to an end state of the disk (coplanar or polar, respectively). More challenging is mapping the parameters of the disk (e.g., binary eccentricity, initial inclination, disk mass, etc.) to a dynamical state. In general, this can be done using expensive 3D disk simulations (e.g., those shown in \citealt{martin2019}, \citealt{smallwood2019}, \& \citealt{abod2022}). It is not feasible to perform such simulations over a large parameter space, so we instead approximate a disk as a geometrically narrow ring with angular momentum equivalent to that of the extended disk it represents. The literature provides a robust theoretical framework for the dynamics of such a ring, with analytical solutions \citep{farago2010,zanazzi2018,martin2019} as well as numerical $n$-body simulations \citep{abod2022,lepp2022} used to translate initial conditions into the ring's dynamical state.

In this study we use three methods, varying from purely analytic to $n$-body and statistical, to calculate $f_\text{polar}$ for a given population. In Section \ref{sec:analytic} we extend the analytic work to massive rings. Section \ref{sec:rk} 
describes the numerical integration of a set of coupled differential equations that describe the evolution of the binary-ring system in the secular approximation of the binary potential. In Section \ref{sec:reb} we treat the binary potential fully using the $n$-body code {\sc rebound} \citep{rebound}, finding only a negligible difference between this method and the much-faster secular approximation. We discuss our results in Section \ref{sec:results}, specifically looking at the effect that the binary eccentricity, relative angular momentum, and initial mutual inclination distributions have on the value of $f_\text{polar}$. Section \ref{sec:discussion} examines the consequences of our narrow-ring approximation, and discusses what considerations must be made to apply our results to an extended disk. Finally, Section \ref{sec:conclusions} describes our overall conclusions. Code implementing the methods described in this paper is publicly available\footnote{\url{\codeurl}, or via \hfill \break \texttt{ pip install git+\codeurl} } as an installable Python package, and the scripts used to generate the figures along with the \LaTeX \space source are available\footnote{\ghurl} as well.

\section{Analytic Treatment}
\label{sec:analytic}
For a massive ring that is misaligned to the binary orbit there are two conditions that determine if the ring is librating \citep[see Equations 31, 32, 38 in][]{martin2019}. Each condition is valid for a different regime of the constant of motion $\chi$ that is defined with
\begin{equation}
    \chi = e_{\rm b}^2 - 2\,(1 - e_{\rm b}^2)\,j\,(2j + \cos{i})\, ,
\end{equation}
for binary eccentricity $e_{\rm b}$, normalized ring angular momentum $j = J_{\rm r}/J_{\rm b}$, and mutual inclination $i$. The condition for libration is
\begin{equation}
    \label{eq:lib_condition}
        \begin{array}{lr}
            -(1-e_\text{b}^2)(2j+\cos{i})^2 + 5e_\text{b}^2 \sin^2{i}\sin^2{\Omega} > 0\, , & \chi > 0 \\
            e_\text{b}^2 + 4j(1-e_\text{b}^2)(-\cos{i} + j(-2+5\sin^2{i}\sin^2{\Omega})) > 0\, , & \chi < 0 .
        \end{array}
\end{equation}
These conditions can be rearranged to find the minimum value of $\Omega$ that will allow for a librating orbit.
\begin{equation}
    \label{eq:omega_min}
    \sin^2{\Omega_{\rm min}} = 
    \left \{
    \begin{array}{lr}
         \frac{(1-e_{\rm b}^2) (2j + \cos^2{i})}{5 e_{\rm b}^2 \sin^2{i}} & \text{if} ~\chi \ge 0\, , \\
    \frac{2}{5 \sin^2{i}} + \frac{\cos{i}}{5j \sin^2{i}} - \frac{e_{\rm b}^2}{20 j^2 (1-e_{\rm b}^2) \sin^2{i}} & \text{if} ~\chi < 0\, .
    \end{array}
    \right .
\end{equation}

Since the range of $\sin^2{\Omega_{\rm min}}$ is $[0,1]$, there exists a critical value for the inclination, $i_{\rm crit}$, below which all orbits circulate. For the $\chi \ge 0$ case, we require
\begin{equation}
    \label{eq:icrit1}
    \frac{5 e_{\rm b}^2}{1-e_{\rm b}^2} \sin^2{i_{\rm crit}} - (\cos{i_{\rm crit}} + 2j)^2 = 0\, ,
\end{equation}
and for the $\chi < 0$ case, $i_{\rm crit}$ satisfies
\begin{equation}
    \label{eq:icrit2}
    \sin^2{i_{\rm crit}} - \frac{\cos{i_{\rm crit}}}{5j} + \frac{e_{\rm b}^2}{20 j^2 (1-e_{\rm b}^2)} + \frac{2}{5} = 0\, .
\end{equation}
If the left-hand side of equation~(\ref{eq:icrit1}) or~(\ref{eq:icrit2}) (depending on the value of $\chi$) evaluates to $<0$, then only circulating orbits are possible. Note that when $j=0$, $\chi \ge 0$ and equation (\ref{eq:omega_min}) recovers equation (75) from \citet{zanazzi2018}.

Given a uniformly distributed $\Omega$, the probability of a polar orbit  is given by
\begin{equation}
    \label{eq:prob_polar}
    P(j,e_{\rm b}, i) = 
    \left \{
    \begin{array}{lr}
         1 - \frac{2}{\pi} \Omega_{\rm min} & \text{if} ~i > i_{\rm crit} \\
        0 & \text{if} ~i \le i_{\rm crit}
    \end{array}
    \right .
\end{equation}
\citep{zanazzi2018,ceppi2024}.
The fraction of polar orbits is then calculated with
\begin{equation}
    \label{eq:fp_int}
    f_{\rm polar} = \iiint P(j,e_{\rm b}, i)\,p_j(j)\,p_{e_\text{b}}(e_\text{b})\,p_i(i)\, dj\,de_{\rm b}\,di\,,
\end{equation}
where $p_j(j)$, $p_{e_\text{b}}(e_\text{b})$, and $p_i(i)$ are the probability distributions of $j$, $e_\text{b}$, and $i$, respectively.

This integral is straightforward to compute numerically, and allows for any desired distribution in $j$, $e_{\rm b}$, or $i$, so long as they are normalized. For example, an isotropic distribution of disk orientation, relative to the binary, would require $p_i(i) = \frac{1}{2}\sin{i}$ for $i$ in the range of $0$ to $\pi$.

\subsection{High-$j$ limit}
\label{subsec:high_j}

When $j$ is very large, the $\chi < 0$ branch of Equation \ref{eq:omega_min} becomes
\begin{equation}
    \sin^2{\Omega_{\rm min}} = \frac{2}{5}\csc^2{i}\, ,
\end{equation}
and the value of $i_{\rm crit}$ is 
\begin{equation}
    i_{\rm crit} = \arccsc{\sqrt{5/2}} = 39.2^\circ\,.
\end{equation}
This is the inclination of the last circular orbit for Kozai-Lidov oscillations in the limit that the perturbed object is very far from the perturber \citep{vonzeipel1910,kozai1962,lidov1962}. Note that it has no dependence on the disk angular momentum or on the binary eccentricity. 

For an isotropic angular momentum distribution,  the polar fraction in this limit is
\begin{align}
    f_{{\rm polar}, j \gg 1} &= \int_0^\pi\,\left (1-\frac{2}{\pi}\arcsin{\left (\sqrt{\frac{2}{5}} \csc{i} \right )}\right ) \sin{i}\,di\, , \\
    & = \variable{output/high_j_integral.txt} \, . \nonumber
\end{align}
This is the value that the higher $j$ curves in Figure \ref{fig:ebin} tend to for low $e_{\rm b}$, computed numerically.

To interpret the Kozai-Lidov oscillations in this limit we can picture a system from the point of view of a far-away stationary observer. When $j \approx 0$, the orbital parameters of the interior binary are not affected by the disk, and the disk undergoes precession or libration due to the effects of the binary. When $j$ is high, however, it is the disk that appears static. An observer would see oscillations in the orbital parameters of the central binary, and its angular momentum and eccentricity vectors would change in response to the disk. This can be thought of in terms of the classical Kozai-Lidov problem, where instead of a planet and its satellite, the interior objects are the binary, and the exterior perturbing object is the circumbinary disk.

%\section{Runge-Kutta-Fehlburg method}
\section{Secular Approximation}
\label{sec:rk}
\citet[Equations (7-10)]{martin2019} also provide a set of coupled first-order differential equations that describe the evolution of $e_{\rm b}$ along with the direction of the disk angular momentum $(\ell_x, \ell_y, \ell_z)$, based on previous work by \citet{farago2010}. We solve these equations using the Runge-Kutta-Fehlberg (RKF, \citealt{fehlberg1969}, see \citealt{hairer2000} p. 177 for implementation) -- a numerical method similar to the common 4th order Runge-Kutta integrator, but that computes a 5th order solution to allow for a variable step size. This method treats the binary in the quadrupole approximation, meaning that it is not sensitive to the effects of the binary mass fraction or orbital dynamics that occur on timescales less than the binary orbital period \citep[e.g.][]{naoz2016}. However, the computational cost is extremely low; we are able to run $10^4$-$10^5$ simulations per second -- about 10,000 times faster than running $n$-body simulations (see Section \ref{sec:reb}).

We determine the dynamical state of the system by tracking the orbital quantities $x=i\,\cos{\Omega}$ and $y=i\,\sin{\Omega}$, where
\begin{equation}
    i = \arccos{\ell_z}
    \label{eq:inclination}
\end{equation}
and
\begin{equation}
    \Omega = \arctantwo (\ell_x, -\ell_y)\, .
    \label{eq:omega}
\end{equation}
If a disk undergoes prograde nodal precession, then these quantities form clockwise loops about the origin as the system evolves. Under retrograde precession, these loops are counter-clockwise. However, any state that would lead to a polar orbit (i.e. libration and crescent patterns) will form closed loops that do not encompass the origin, and these tracks will never cross the line $i\,\sin{\Omega}=0$. The state can be determined by tracking the quadrant of the point $(i\,\cos{\Omega},~i\,\sin{\Omega})$: prograde orbits will traverse all quadrants in the order [I, IV, III, II], and retrograde orbits will travel in the opposite order. A polar orbit that starts in quadrant I or II, however, is restricted to those two quadrants and will alternate between them. The same goes for polar orbits in quadrants III and IV. Therefore, the dynamical state can often be determined by the list of previous quadrant crossings. For example, I$\rightarrow$IV can only be caused by prograde precession, III$\rightarrow$IV is ambiguous, and III$\rightarrow$IV$\rightarrow$III indicates a polar orbit.

We estimate the value of Equation (\ref{eq:fp_int}) using this method by computing the integral of $P(j,e_{\rm b},i)\,p_i(i)\,di$ over all $i$; this is the probability of a polar orbit given some $j$ and $e_{\rm b}$. This is done numerically using a grid of simulations, as shown if Figure \ref{fig:grid_example}. These simulations all vary in their initial conditions, with the longitude of the ascending node $\Omega \in [0,2\pi)$ and mutual inclination $i \in [0,\pi]$.

\begin{figure}
    \begin{centering}
        \includegraphics[width=0.5\textwidth]{figures/grid_example.pdf}
    \end{centering}
    \caption{
        Grid of dynamical states for \variable{output/grid_example_n_sims.txt} RKF simulations of a system with $e_{\rm b}=\variable{output/grid_example_eb.txt}$ and $j=0.1$. This grid can be run for any combination of $(e_{\rm b},\,j)$, and integrating over the polar region computes the fraction of systems in which a disk would evolve to a polar state.
    }
    \script{grid_example.py}
    \label{fig:grid_example}
\end{figure}

\section{$n$-body simulations}
\label{sec:reb}

We use the N-body integration software {\sc rebound} \citep{rebound} to simulate a circumbinary system with an additional level of sophistication compared to those described in Section \ref{sec:rk}, in which the binary was treated in the quadrupole approximation. We model the disk as a point mass with its same orbital parameters and angular momentum.

For any given system, the dynamical state is determined similarly to the method described in Section \ref{sec:rk}. Note, however, that the $(i\,\cos{\Omega},~i\,\sin{\Omega})$ tracks now contain small structure on the orbital timescale of the outer mass. These structures can mean that a simulation may not make monotonic progress along its track, occasionally backtracking. Such a backtrack can give a false reading of the dynamical state if it occurs across the $x$ or $y$ axis. To mitigate this problem, we integrate each system until it returns to its original position in $(i\,\cos{\Omega},~i\,\sin{\Omega})$ space. If, at this point, the path does not enclose the origin, then it is polar. Prograde and retrograde motions can be distinguished by the sign of $\langle d\Omega/dt \rangle$. Figure \ref{fig:sim_example} shows paths for a set of simulations initialized with $\Omega = \pi/2$.

\begin{figure}
    \begin{centering}
        \includegraphics[width=0.5\textwidth]{figures/sim_example.pdf}
        \caption{Example of system simulation and state determination. This figure tracks the orbital parameters
        of a third body with $j=0.05$ orbiting a $1 M_\odot$ binary with equal mass stars and $e_b = 0.4$.
        Initially $\Omega = \frac{\pi}{2}$ in all cases.}
        \label{fig:sim_example}
        \script{sim_example.py}
    \end{centering}
\end{figure}

We use the IAS15 Gauss-Radau integrator \citep{reboundias15}, which is a 15th-order variable step size numerical integrator. The maximum time-step this requires is on the order of the binary orbital period, and the integration is therefore much slower than the RKF algorithm, at approximately 2 iterations per second (for $a/a_\text{b}=5$). However, the time required to determine the dynamical state depends on the precession timescale, with some simulation states still undetermined after $10\,000$ outer-mass orbits ($\sim \,$5 seconds). This happens rarely enough that it is most efficient to simply stop the integration, and return an unknown state which must be factored in to our uncertainties. The precession timescale is greatest near the boundary of the precession and libration regions (formally infinite at the boundary, \citealt{farago2010}, see also Figure 16 of \citealt{rabago2024}), and so these boundary simulations are the most likely to be stopped before a dynamical state can be determined. We therefore expect both polar and coplanar simulations to be terminated early at approximately equal rates, and that this method will not introduce bias into our results.

Given that these simulations take much longer than the RKF algorithm, we cannot compute the same grid of dynamical states. Instead, we employ a Monte Carlo (MC) method to estimate the probability of a polar orbit. For any set of parameters (including the binary fraction $f_{\rm b}$ now) we sample isotropically on the $i$-$\Omega$ sphere, and use the bootstrap method to estimate $f_{\rm polar}$. We sample in batches of 4 and stop when the bootstrap confidence interval metric reaches a prescribed value. After each batch, the results are written to an SQLite database to be recalled in the future. Upon initialization, the MC sampler queries this database for all relevant results.


\begin{figure}
    \begin{centering}
        \includegraphics[width=0.5\textwidth]{figures/compare_massive.pdf}
        \caption{
            MC results (points) for $e_{\rm b}=0.4$, $j=0.66$, and $f_{\rm b}=0.5$ compared to RKF results for the same setup (contour lines). This value of $j$ is chosen here as it is the critical value \citep[see][]{martin2019,abod2022}, beyond which retrograde dynamical states are not allowed. The regions interior to the black contour lines are initial conditions which allow polar orbits according to the RKF method.
            Note that some points that {\sc rebound} classifies as polar fall outside the RKF polar region.
            The MC result gives $f_{\text{polar}} = \variable{output/mc_out.txt}$ while the RKF result gives $f_{\text{polar}} = \variable{output/rk_out.txt}$ with
            numerical error on the order of $\variable{output/rk_err.txt}$.
        }
        \script{compare_massive.py}
        \label{fig:rkf}
    \end{centering}
\end{figure}

Figure \ref{fig:rkf} shows that, while the RKF and {\sc rebound} simulations produce similar results, they are not identical. Specifically noticeable are points sampled by the MC algorithm that lie outside the RKF libration region (with a higher inclination), but are found by {\sc rebound} to librate. There are also points with the opposite discrepancy -- those that lie in the RKF libration region but produce prograde precession -- but they are fewer and not as noticeable by eye. This discrepancy arises because the secular approximation averages the central potential over the orbital period of the binary, while in this section we are treating the full $n$-body dynamics. The two schemes converge when $a \gg a_\text{b}$, and we can eliminate this discrepancy by increasing $a$ (e.g., $a=25a_\text{b}$ compared to our nominal choice of $5a_\text{b}$). In general, the choice of small $a/a_\text{b}$ changes the shape of the parameter space that allows polar orbits when compared to those found in Section \ref{sec:rk}, but not enough to have a significant effect on $f_\text{polar}$. In fact, this bias is small enough that -- given uncertainties introduced by our limited number of samples -- we cannot distinguish between the polar fractions inferred from the two methods. Because the secular approximation used in Sections \ref{sec:analytic} \& \ref{sec:rk} require significantly lower computational cost, and the differences in results are insignificant, we choose to focus on the secular approximation results in the following sections.

\section{Results}
\label{sec:results}

To determine the polar fraction of a given population of geometrically narrow rings we must consider three distributions: $p_j(j)$, $p_{e_\text{b}}(e_\text{b})$, and $p_i(i)$. If these distributions were known, it would be easy to calculate $f_\text{polar}$ for a population. However, none are well constrained, so in this section we calculate $f_\text{polar}$ considering one distribution at a time, drawing on parameterizations from relevant literature when available.

\subsection{Effects of $j$}
\label{subsec:effect-j}

\begin{figure*}[!htbp]
    \begin{centering}
        \includegraphics[width=1\textwidth]{figures/compare_ebin.pdf}
        \caption{
            Polar fraction as a function of $e_{\rm b}$ for various values of $j$. Each line is computed via a numerical integration of equation (\ref{eq:prob_polar}), assuming an isotropic distribution of $i$.
            In the low-$j$ regime the polar fraction is a strong function of $e_{\rm b}$. However, as $j$ increases, $f_{\rm polar}$ becomes insensitive to the binary eccentricity (except for the case that $e_\text{b}\approx 1$). Note that $f_\text{polar}(e_\text{b}\approx 0)$ is maximized when $j=0.5$.
        }
        \script{compare_ebin.py}
        \label{fig:ebin}
    \end{centering}
\end{figure*}

We choose to consider specific values of $j$ rather than a parameterized distribution (equivalent to setting $p_j(j) = \delta(j-j_0)$). This choice is motivated by the lack of published observational or theoretical constraints on the disk-to-binary angular momentum ratio. Even if the distribution were known, it would likely not be useful because of the possibility for extended disks to warp and break, leading to independent ring evolution (see Section \ref{sec:discussion}).

Figure \ref{fig:ebin} shows $f_\text{polar}(e_\text{b})$ for various values of $j$. We see here two limiting behaviors: when $j$ is small, then $f_\text{polar}\sim e_\text{b}$. However, when $j$ is large (and $e_\text{b}$ is not close to $1$), then the Kozai-Lidov behavior discussed in Section \ref{subsec:high_j} dominates and $f_\text{polar}\approx \text{const}$. Note that, while these calculations assumed $p_i(i)$ such that the ring direction is isotropic, we show in Section \ref{subsec:change_i} that the qualitative behaviors are independent of any preference (or lack of preference) for coplanar initial conditions.

\subsection{Effects of $e_\text{b}$}
\label{subsec:effect-eb}

\begin{figure*}
    \centering
    \includegraphics[width=\textwidth]{figures/fpol_j.pdf}
    \caption{
        Polar disk fraction $f_\text{polar}$ as a function of $j$ for various distributions $p_{e_\text{b}}(e_\text{b})$. All cases assume isotropic distributions of initial angular momentum. In the thermal case, $p_{e_\text{b}}(e_\text{b}) \propto e_\text{b}$. In the uniform case, $p_{e_\text{b}}(e_\text{b}) = \text{const}$. The case labeled $e_\text{b} < 0.1$ uses a uniform distribution, but restricts the domain to $e_\text{b} \in [0,0.1)$. These three distributions are shown in the inset. The dashed line cases fix $e_\text{b}$ at a particular value. Notice the maximum that occurs at $j\approx 0.5$. This occurs because the appearance of crescent orbits along with the disappearance of retrograde orbits at $j=j_\text{cr}$ \citep[eq. A3]{martin2019} make the parameter space that eventually evolves to polar very large.
    }
    \script{f_p_of_j.py}
    \label{fig:fpol_j}
\end{figure*}

Typical distribution functions for binary eccentricity have the form $p_{e_\text{b}}(e_\text{b}) \propto e_\text{b}^\alpha$, with the special cases of $\alpha=0,\,1$ referred to as ``uniform'' and ``thermal'', respectively \citep[see also \citealt{ceppi2024}]{hwang2022}. \citet{hwang2022} found that, for wide binaries, the distribution changes from uniform at $a_\text{b}\approx 100\text{AU}$ to thermal at $a_\text{b}\approx 500\text{AU}$. For shorter-period binaries, tidal forces lead to a strong preference for circular orbits, but it is not clear that the circularization timescale is short enough to use as an initial condition \citep[e.g.,][]{meibom2005,geller2012}. The requirement on the circularization timescale would be $t_\text{circ} < t_p$, where $t_p$ is the precession timescale.

Figure \ref{fig:fpol_j} shows $f_\text{polar}$ as a function of $j$ for various choices of $p_{e_\text{b}}(e_\text{b})$. As expected, the curves all converge in the Kozai-Lidov regime. The uniform and thermal distributions both produce polar fractions $>0.5$ for small $j$, with the thermal distribution slightly higher. Except for when $j$ is close to 0, the circularized $e_\text{b} < 0.1$ curve follows the $e_\text{b} = 0.01$ curve very closely, including a maximum at $j=0.5$. This feature is present to some degree in all the low-$j$ curves, and is the result of the fact that, for $e_\text{b}=0$, the critical value for $j$ is 0.5 \citet{abod2022}. The size and shape of the prograde, retrograde, and libration regions change very quickly at this value, with no retrograde orbits allowed when $j>j_\text{cr}$, where $j_\text{cr}$ is the critical value of $j$ above which crescent orbits are allowed \citep[eq. A3]{martin2019}.

\subsection{Effects of $i$}
\label{subsec:change_i}

\begin{figure*}
    \begin{centering}
        \includegraphics[width=\textwidth]{figures/compare_ebin_idist.pdf}
        \caption{
            Same as Figure \ref{fig:ebin}, but with the mutual inclination distribution given by equation (\ref{eq:idist}).
        }
        \script{compare_ebin_idist.py}
        \label{fig:ebin-idist}
    \end{centering}
\end{figure*}

\begin{figure*}
    \begin{centering}
        \includegraphics[width=\textwidth]{figures/fpol_j_idist.pdf}
        \caption{
            Same as Figure \ref{fig:fpol_j}, but with the mutual inclination distribution given by equation (\ref{eq:idist}).
        }
        \script{f_p_of_j_idist.py}
        \label{fig:fpol_j-idist}
    \end{centering}
\end{figure*}


In all previous results we have assumed that the there is no preferred direction of $\bm{j}$. For a population, this means that $\Omega$ is uniformly distributed between $0$ and $2\pi$ and $i$ is associated with the distribution function
\begin{equation}
    \label{eq:iso-i}
    p_i(i) = \frac{1}{2}\sin{i} .
\end{equation}

Hydrodynamic simulations by \citet{elsender2023} found that this assumption is valid for short-period binaries (those with separations $\sim 1$ AU). For wider binaries, however, a distribution function that prefers alignment would be more appropriate.

In this section we will break from the isotropic assumption and look at how $f_\text{polar}$ changes when we adopt a distribution that prefers low initial mutual inclinations. \citet{ceppi2024} proposed a normalized exponential distribution:
\begin{equation}
    p_i(i) = \frac{1}{\sigma(1-\exp{(-\pi/\sigma)})} \exp{\left(\frac{-i}{\sigma}\right)},
\end{equation}
where $\sigma$ is a parameter that encodes the distribution's preference (or lack of preference) for low mutual inclinations.
However, this distribution does not become isotropic for large $\sigma$, and results in probability densities (per unit solid angle) that diverge at $i=0,\,\pi$. We employ the following parameterization instead:
\begin{equation}
    \label{eq:idist}
    p_i(i) = \frac{1+\sigma^2}{\sigma^2 (\exp{(-\pi/\sigma)}+1)}\,\sin{i}\,\exp{\left(\frac{-i}{\sigma}\right)},
\end{equation}
which converges to equation (\ref{eq:iso-i}) in the limit $\sigma \rightarrow \infty$.

Figure \ref{fig:ebin-idist} shows that when low mutual inclinations are preferred as an initial condition, the fraction of systems that result in a polar orbit drop dramatically, and that this effect is fairly consistent across values for $e_\text{b}$. Figure \ref{fig:fpol_j-idist} similarly shows this effect, but with an interesting caveat: in the model with the heaviest preference for coplanar initial conditions, the fraction of polar disks is fairly high when $j=0$ and $e_\text{b}$ has either a uniform of thermal distribution ($>0.5$ in the thermal case).

\section{Discussion}
\label{sec:discussion}

\subsection{Timescales}
In order to map a dynamical state to a final alignment (e.g. librating orbit $\mapsto$ polar alignment), we are required to assume that the disk lifetime $t_\text{disk}$ is longer than the disk evolution timescale $t_\text{evol}$. The evolution timescale is the characteristic decay time for a disk whose inclination has been perturbed from a stable point (e.g., polar or coplanar), and while it is described by \citet{lubow2018} in their equation (29), it is only known up to a constant of proportionality:
\begin{equation}
    \label{eq:tevol}
    t_\text{evol} \propto \frac{h^2}{\alpha f^2(1-f)^2 e_\text{b}^2(1+4e_\text{b}^2) \Omega_\text{b}} ,
\end{equation}
where $h\equiv H/r$ is the disk aspect ratio, $f\equiv M_2/M$ is the mass ratio, and $\Omega_\text{b}$ is the binary orbital frequency. 

We can further constrain the evolution timescale if we decide that it must not be shorter than the precession timescale, and is likely of similar order. \citet[see eq. (2.32)]{farago2010} give an analytic expression for the precession period of a test particle orbiting an eccentric binary, which we write in our own variables as
\begin{equation}
    t_\text{p} = \frac{16}{3f(1-f)} \Omega_\text{b}^{-1} \left(\frac{r}{a_\text{b}}\right)^{7/2} \Gamma_1(e_\text{b},i,\Omega)\, ,
\end{equation}
where $\Omega_\text{b}$ is the binary orbital frequency and $\Gamma_1$ is a dimensionless constant that depends on the initial conditions:
\begin{equation}
    \Gamma_1(e_\text{b},i,\Omega) = \frac{K(k^2)}{\sqrt{(1-e_\text{b}^2)(h+4e_\text{b}^2)}} \, .
\end{equation}
$k^2$ and $h$ are constants that \citet{farago2010} define in their equations (2.31) and (2.20), respectively. $K(k^2)$ is the elliptic integral of the first kind, which \citet{farago2010} gives in equation (2.33).

Note that $\Gamma_1$ depends on $e_\text{b}$, and so it is only a constant in the case of a test particle. For $j>0$, we must compute the precession timescale ourselves. The time coordinate used in Section \ref{sec:rk} is $\tau \equiv \alpha' t$. $\alpha'$ is defined by \citet[see eq. 3.9]{farago2010}, and we write it as
\begin{equation}
    \alpha' \equiv \frac{3}{4} \Omega_\text{b} \left(\frac{a_\text{b}}{r}\right)^{7/2} f(1-f) \,\Gamma_2(j,f,a_\text{b}/r, e_\text{b}) \, ,
\end{equation}
where we have written the $\sqrt{1+m_\text{r}/M_\text{b}}$ factor as $\Gamma_2$. Written in terms of our variables, this expression is very complicated, and we choose to compute it numerically for simplicity. Note, however, that except for extremely large $j$ (e.g. $>10$), $\Gamma_2 \sim 1$.

Given some precession timescale in code units $\tau_\text{p}$, we can calculate the precession timescale
\begin{equation}
    \label{eq:tp-j}
    t_\text{p} = \frac{4}{3}\Omega_\text{b}^{-1} \left(\frac{r}{a_\text{b}}\right)^{7/2} \frac{\tau_\text{p}}{f(1-f)\Gamma_2}\, .
\end{equation}
Compared to the precession timescale for a test particle, that is
\begin{equation}
    \label{eq:tp-rat}
    \frac{t_{\text{p,}j}}{t_{\text{p,}j=0}} = \frac{\tau_\text{p}}{4\,\Gamma_1\,\Gamma_2} \, .
\end{equation}

\begin{figure}
    \includegraphics[width=0.5\textwidth]{figures/precession_time.pdf}
    \caption{
        Effect of $j$ on the precession timescale as calculated in equation (\ref{eq:tp-rat}). {\bf Top}: Ratio between the numerically computed precession timescale and the analytic solution for a massless ring. To compute the solid lines, the inclination is fixed and only $j$ varies. Twice the orbit switches between circulation and libration, and the timescale becomes very long at that boundary. For the dashed lines, $i$ is held $5^\circ$ away from a stationary point. In the librating case, this stationary point is given by equation (15) of \citet{martin2019}. In the prograde case, the stationary point is coplanar. For all simulations the step size is $\Delta j = 10^{-3}$, and we assume $e_\text{b}=0.4$, $f=0.5$, $a_\text{b}/r = 1/5$, and $\Omega_0 = \pi/2$. {\bf Bottom}: $(i,\Omega)$ tracks for all 2000 simulations that compose the solid line in the top panel. The arrow points to the initial conditions for every line (marked by the red point). The divergence of the different tracks is due to the change of $j$ only.
    }
    \script{precession_time.py}
    \label{fig:t_p}
\end{figure}

Figure \ref{fig:t_p} shows that $j$ has two different effects on $t_\text{p}$. The most obvious is that when $j$ changes, the location of the boundary between dynamical regimes also changes. This can cause huge spikes in the timescale ratio as that boundary moves close to the initial conditions $(i_0, \Omega_0)$. The other effect is that the timescale ratio becomes small as $j$ increases. We find that the slope for large j is rather consistent, with $t_\text{p}\propto j^{-1} \text{ to } j^{-1.2}$, with the exponent varying slightly with changes to $f$ or $a_\text{b}/r$. 

Given some set of assumptions, we can calculate the fraction of binary systems for which the precession timescale is too long to reach a coplanar or polar orbit. Planets formed in these disks will undergo secular oscillations for the entire lifetime of their system. This fraction is a strong function of the radius of the ring, and differential precession of an extended disk will cause warps and breaks (see Section \ref{subsec:breaks})

\begin{figure}
    \includegraphics[width=0.5\textwidth]{figures/grid_example_tp.pdf}
    \caption{Same as Figure \ref{fig:grid_example}, but with a mask over the region where $t_\text{p} > t_\text{disk}$. Parameters used are an equal-mass binary with $M_\text{b} = M_\odot$, $e_\text{b} = 0.4$, $j=0.1$, $a_\text{b} = 1\text{ AU}$, $r/a_\text{b} = 30$, and $t_\text{disk} = 10^6 \text{ years}$. Note that \variable{output/grid_example_tp.txt}\% of initial conditions remain misaligned in this setup, but this fraction is near zero when $r/a_\text{b} = 20$ and near 1 when $r/a_\text{b} = 40$. Not shown are versions of this figure where $e_\text{b}$ and $j$ have been varied. We have found that up to 85\% of simulations remain misaligned when $e_\text{b}=10^{-6}$, but if $j$ is subsequently increased to 10 then that becomes 1\%. }
    \script{grid_example_tp.py}
    \label{fig:grid-tp}
\end{figure}

\subsection{Disk breaking}
\label{subsec:breaks}
\citet{rabago2024} provides a framework for discussing extended disks which form discontinuities in $i$ and $\Omega$ due to differential precession and libration. Essentially, the dominant timescale in such a disk is that at the inner edge (recall in equation (\ref{eq:tp-j}) that $t_\text{p} \propto r^{7/2}$).
In a wave-like (low-viscosity) disk, the break occurs at the radius where the inner edge precession timescale is equal to the radial communication timescale. In the diffusive (high-viscosity) disk regime, however, the alignment timescale is very short compared to the precession timescale, and it is possible for the disk to reach coplanar or polar alignment without very much differential precession, suppressing any potential warps. It is still possible, however, for this fast alignment to take longer than a disk lifetime, and we cannot guarantee that all diffusive disks will be able to evolve to coplanar or polar -- only that they are less likely to break.

Consider now a wave-like disk with inner radius $r_\text{in}$ and outer radius $r_\text{out}$. If $r_\text{out}$ is sufficiently large, then a break will occur at a radius $r_\text{break}$ that depends on the specific parameters of the disk \citep[see][eq. (9)]{rabago2024}. The two regions can be treated independently of each other. For the inner disk, the outer edge is sufficiently connected to the inner edge, and the whole region precesses together on a characteristic timescale $t_\text{p}(r_\text{in}) < t_\text{p} \lesssim t_\text{p}(r_\text{break})$. The outer disk may break again if $r_\text{out}$ is very large, but either way it will precess on its own characteristic timescale. We now have two independent rings, each with its own precession timescale. Due to the strong dependence of $t_\text{p}$ on $r$, the inner disk is much more likely to reach alignment in a disk lifetime, and the different alignment timescales means the disks will be misaligned from each other, potentially causing a shadow to be cast on the outer disk \citep[see][]{benisty2023,su2024,zhang2024,zhu2024}.

\subsection{Self-gravitation}
\label{subsec:toomre}
Just as the disk-breaking framework in Section \ref{subsec:breaks} places an upper limit on the outer radius of an extended disk, we can use the gravitational instability criterion to place a lower limit on that outer radius for constant $j$. In this section we will calculate the maximum $j$ that is allowed for a disk with a given radial extent before it becomes gravitationally unstable. This discussion applies to any disk that one may wish to describe with the dimensionless relative angular momentum $j$, not just the misaligned disks we have focused on so far. The criterion for stability against self-gravitation \citep{toomre1964} can be written
\begin{equation}
    \label{eq:toomre}
    \frac{hM_\text{b}}{\pi r^2 \Sigma} > 1\, ,
\end{equation}
where $h\equiv H/r$ is the aspect ratio of the disk and $\Sigma$ is the surface density. We will assume $h$ is constant. If $\Sigma = \Sigma_\text{in} (r/r_\text{in})^{-p}$ and $p>0$, then the angular momentum of the ring (in the limit $M_\text{r} \ll M_\text{b}$) is
\begin{align}
    J_\text{r} &= \int_{r_\text{in}}^{r_\text{out}} 2\pi r \Sigma  \sqrt{GM_\text{b}r}\,dr \, , \nonumber \\
    & = \frac{2\pi\sqrt{GM_\text{b}}}{5/2 - p} \Sigma_\text{in} r_\text{in}^{5/2} \left( \left( \frac{r_\text{out}}{r_\text{in}} \right)^{5/2 - p}- 1\right)\, \label{eq:Jr}.
\end{align}

First, we rewrite the stability criterion given in equation (\ref{eq:toomre}):
\begin{equation}
    \label{eq:toomre2}
    \frac{h M_\text{b}}{\pi r_\text{in}^p \Sigma_\text{in} r^{2-p}} > 1\, .
\end{equation}

Looking at equation (\ref{eq:Jr}) and equation (3) of \citet{abod2022}, we can write $j$ as
\begin{equation}
    \label{eq:j-full-disk}
    j = \frac{2\pi \Sigma_\text{in} r_\text{in}^{5/2}}{(5/2-p)f(1-f)M_\text{b}\sqrt{a_\text{b}(1-e_\text{b}^2)}}  \left( \left( \frac{r_\text{out}}{r_\text{in}} \right)^{5/2 - p}- 1\right) \, .
\end{equation}

The location of the instability depends on $p$ as shown in equation \ref{eq:toomre2}. When $p<2$ it is at the inner edge, when $p>2$, at the outer edge, and can onset globally if $p=2$.

\subsubsection{$p<2$}
\label{subsubsec:shallow-p}
For a shallow power law disk we evaluate at the inner edge. There is a maximum value for $\Sigma_\text{in}$:
\begin{equation}
    \Sigma_\text{max} = \frac{hM_\text{b}}{\pi r_\text{in}^2}\, .
\end{equation}

The maximum value of $j$ to be stable against self-gravity is
\begin{equation}
    \label{eq:jmax-shallow}
    j_\text{max} = \frac{2h}{f (1-f) (5/2 - p)\sqrt{1-e_\text{b}^2}} \sqrt{\frac{r_\text{in}}{a_\text{b}}} \left( \left( \frac{r_\text{out}}{r_\text{in}} \right)^{5/2 - p}- 1\right)\, .
\end{equation}

If we consider a $p=1$ disk orbiting an equal mass binary with $e_\text{b}=0.4$, $h=0.01$, and $r_\text{in}/a_\text{b}=2.5$, then for a relatively narrow ring ($r_\text{out}/r_\text{in} = 2$), we calculate $j_\text{max} = 0.17$. If the disk is allowed to be more extended (in this case $r_\text{out}/r_\text{in} = 10$), then we find $j_\text{max} = 2.8$. 

\subsubsection{$p>2$}
If the surface density power law is sufficiently steep (and not equal to $5/2$), then instability will arise at the outer edge. The maximum surface density at the inner edge becomes
\begin{equation}
    \Sigma_\text{max} = \frac{h M_\text{b}}{\pi r_\text{in}^2 (r_\text{out}/r_\text{in})^{2-p}}\, ,
\end{equation}
and the maximum angular momentum is
\begin{multline}
    \label{eq:jmax-steep}
    j_\text{max} = \frac{2h}{f (1-f) (5/2 - p)\sqrt{1-e_\text{b}^2}} \\ 
    \sqrt{\frac{r_\text{in}}{a_\text{b}}} \left( \frac{r_\text{out}}{r_\text{in}}\right)^{2-p} \left( \left( \frac{r_\text{out}}{r_\text{in}} \right)^{5/2 - p}- 1\right) \, .
\end{multline}

Note that equation (\ref{eq:jmax-steep}) is less than equation ({\ref{eq:jmax-shallow}}) by a factor of $(r_\text{out}/r_\text{in})^{2-p}$. If we consider the same example as in Section \ref{subsubsec:shallow-p}, except with $p=3$, we find that in the narrow case ($r_\text{out}/r_\text{in} = 2$), $j_\text{max} = 0.040$, and is even smaller for $r_\text{out}/r_\text{in} = 10$, at  $j_\text{max} = 0.019$.

\subsubsection{$p=2$}
Equations (\ref{eq:jmax-shallow} \& \ref{eq:jmax-steep}) are equivalent when $p=2$, and both analyses are equally valid. The qualitative change that occurs when $p=2$ is that instability does not onset at either disk edge, but is independent of radius and occurs everywhere simultaneously. Again, following the example parameters listed above, we find that $j_\text{max} = 0.11$ for $r_\text{out}/r_\text{in} = 2$ and $j_\text{max} = 0.60$ for $r_\text{out}/r_\text{in} = 10$.

\subsubsection{Consequences for $f_\text{polar}$}
The above discussion places an upper limit on what values of $j$ are physical in a given system. As a consequence, a high-$j$ disk is either gravitationally unstable or highly radially extended, although we note that gravitational instability in a warped disc may be suppressed by the heating from the warp propagation \citep{rowther2022}.  A radially extended disk is more likely to break, effectively lowering the value of $j$. This process is highly dependent on the parameters of a particular system, but there may be a general preference for small $j$ by means of gravitational instability and disk breaking. 
%It may be then, that the distributions of the polar fraction presented in this paper when $j=0$ are the most realistic.

\section{Conclusions}
\label{sec:conclusions}

In this study we attempt to quantify the fraction of polar disks in circumbinary systems using the dynamics of a narrow ring. We do this analytically, numerically in the secular approximation, and numerically using the full binary potential. We find that the three methods produce values of the polar fraction that are identical within their uncertainties.

Our results show that $f_\text{polar}$ is heavily dependent on the underlying parameter distributions that make up a population of systems. In general, we find for low mass disks that $f_\text{polar} \sim e_\text{b}$, and for high mass disks $f_\text{polar} \rightarrow \text{const.}$ as $j\rightarrow \infty$, with the value of the constant being 0.37 if the directions of the disk angular momentum vectors are isotropically distributed.
If we consider a population of low mass disks with a uniform distribution of $e_\text{b}$, then our results are consistent with previous results from \citet{ceppi2024} which found $f_\text{polar}\sim 0.5$. 

Most of the calculations presented in this work assume that the initial disk angular momentum vector has no preference for its direction, and that the distribution is isotropic. However, we also include calculations that unsurprisingly show that $f_\text{polar}$ is reduced when disks tend to be aligned with their host at the time of formation.

Each of the three methods we employ in this paper has its own benefits. With our analytic results, it is possible to compute $f_\text{polar}$ for an arbitrarily large population of systems in less than 1 second. In the same time, our secular numerical method can explore $\sim 50\,000$ combinations of initial conditions for a system, returning relevant timescales and the evolution of orbital parameters for each setup. Our numerical simulations in the full binary potential (using {\sc rebound}) are much slower, at $\sim 1/\text{s}$, but allow the inclusion of smaller effects such as those from the binary mass fraction and semi-major axis ratios. Each method balances information output with computational cost.

A fourth method, which we do not consider due to its high cost, would be to run full hydrodynamic simulations of the disk. Such simulations would account for all the additional effects discussed in Section \ref{sec:discussion}, but are not suitable for a large parameter space study. In a detailed study of a particular system our results can be used to gain insight into the dynamics before simulating the full disk. For example, equation (\ref{eq:j-full-disk}) can be used to compute $j$ for a power-law disk, and any of the methods described in Section \ref{sec:analytic}-\ref{sec:reb} can then be used to estimate the dynamical state of the system.

We also discuss the limitations of our methods. First, we look at the effect of finite disk lifetime on the ability for a disk to complete its evolution to a stationary state. Disks with long evolutionary timescales remain with orbital parameters near their initial conditions for their entire lifetimes. We also look at limitations imposed by the fact that real disks are not geometrically narrow rings, but have some radial extent. Real disks are likely to break if their radial extent is too large, and will become gravitationally unstable if all of their mass in concentrated in too narrow of a ring. These two effects impose constraints on the relationship between $r_\text{in}$, $r_\text{out}$, and $j$.




\begin{acknowledgements}
\label{sec:ack}

We acknowledge support from NASA through grants 80NSSC21K0395 and 80NSSC19K0443. This manuscript was prepared using the open-science software \href{https://show-your.work/en/latest/intro/}{\showyourwork} \citep{luger2021}, making the article completely
reproducible. The source code to compile this document and create the figures is available on GitHub\footnote{\ghurl}.
Simulations in this paper made use of the {\sc rebound} N-body code \citep{rebound}.
The simulations were integrated using IAS15, a 15th order Gauss-Radau integrator \citep{reboundias15}. 

\end{acknowledgements}

\bibliography{cbdisk,syw,reb}

\end{document}
